{% load static %}
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="{% static '/workouts/style.css' %}">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Workout Results</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .page-container { max-width: 800px; margin: 0 auto; }
    h1, h2, h3 { margin-bottom: 10px; }
    .workout-header, .error-box { border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; }
    .stat-box { border: 1px solid #ccc; padding: 10px; margin: 5px 0; }
    .exercise-card { border: 1px solid #ccc; padding: 15px; margin-bottom: 15px; }
    .exercise-header { display: flex; justify-content: space-between; align-items: center; }
    .exercise-meta, .muscle-tags { margin: 10px 0; }
    .meta-badge, .muscle-tag { border: 1px solid #ccc; padding: 3px 6px; margin-right: 5px; display: inline-block; }
    .sets-reps-box, .exercise-description { border: 1px solid #ccc; padding: 8px; margin: 10px 0; }
    .exercise-image { max-width: 100%; height: auto; border: 1px solid #ccc; margin-top: 10px; }
    .action-buttons { margin: 30px 0; text-align: center; }
    .btn { border: 1px solid #ccc; padding: 8px 15px; text-decoration: none; margin: 0 5px; display: inline-block; color: black; }
    footer { text-align: center; margin-top: 30px; font-size: 0.9em; border-top: 1px solid #ccc; padding-top: 10px; }
  </style>
</head>
<body>
  <div class="page-container">

    <!-- Error message -->
    {% if error_message %}
      <div class="error-box">
        <h3>Error</h3>
        <p>{{ error_message }}</p>
        <a href="{% url 'workout_generator_page' %}" class="btn">Back to Generator</a>
      </div>

    {% elif category and exercises %}
      <!-- Random preset workout -->
      <div class="workout-header">
        <h1>{{ category|title }} Workout</h1>
        <div class="stat-box">
          <p>Exercises: {{ total_exercises|default:"0" }}</p>
          <p>Goal: {{ goal|title|default:"Hypertrophy" }}</p>
          <p>Estimated Duration: {{ estimated_duration|default:"45 min" }}</p>
        </div>
      </div>

      {% for exercise in exercises %}
        <div class="exercise-card">
          <div class="exercise-header">
            <h3>{{ exercise.name }}</h3>
            <span>Exercise #{{ forloop.counter }}</span>
          </div>

          <div class="exercise-meta">
            <span class="meta-badge">{{ exercise.get_mechanics_display|default:"Exercise" }}</span>
            <span class="meta-badge">{{ exercise.get_difficulty_display }}</span>
            <span class="meta-badge">
              {% if exercise.equipment.all %}
                {% for eq in exercise.equipment.all %}
                  {{ eq.name }}{% if not forloop.last %}, {% endif %}
                {% endfor %}
              {% else %}
                Bodyweight
              {% endif %}
            </span>
          </div>

          <div class="muscle-tags">
            {% for pm in exercise.primary_muscle.all %}
              <span class="muscle-tag">Primary: {{ pm.name }}</span>
            {% endfor %}
            {% for sm in exercise.secondary_muscles.all %}
              <span class="muscle-tag">Secondary: {{ sm.name }}</span>
            {% endfor %}
          </div>

          {% if exercise.description %}
            <div class="exercise-description">{{ exercise.description }}</div>
          {% endif %}

          {% if exercise.image_url %}
            <img src="{{ exercise.image_url }}" alt="{{ exercise.name }}" class="exercise-image">
          {% endif %}
        </div>
      {% endfor %}

    {% elif workout %}
      <!-- Generated advanced workout -->
      <div class="workout-header">
        <h1>Your Workout Plan</h1>
        <div class="stat-box">
          <p>Exercises: {{ total_exercises|default:"0" }}</p>
          <p>Goal: {{ goal|title|default:"Hypertrophy" }}</p>
          <p>Estimated Duration: {{ estimated_duration|default:"45 min" }}</p>
        </div>
      </div>

      {% for muscle, exercises in workout.items %}
        <h2>{{ muscle }}</h2>
        {% for entry in exercises %}
          {% with exercise=entry.exercise %}
          <div class="exercise-card">
            <div class="exercise-header">
              <h3>{{ exercise.name }}</h3>
              {% if entry.order %}
                <span>Exercise #{{ entry.order }}</span>
              {% endif %}
            </div>

            <div class="exercise-meta">
              <span class="meta-badge">{{ exercise.get_mechanics_display|default:"Exercise" }}</span>
              <span class="meta-badge">{{ exercise.get_difficulty_display }}</span>
              <span class="meta-badge">
                {% if exercise.equipment.all %}
                  {% for eq in exercise.equipment.all %}
                    {{ eq.name }}{% if not forloop.last %}, {% endif %}
                  {% endfor %}
                {% else %}
                  Bodyweight
                {% endif %}
              </span>
            </div>

            <div class="muscle-tags">
              {% for pm in exercise.primary_muscle.all %}
                <span class="muscle-tag">Primary: {{ pm.name }}</span>
              {% endfor %}
              {% for sm in exercise.secondary_muscles.all %}
                <span class="muscle-tag">Secondary: {{ sm.name }}</span>
              {% endfor %}
            </div>

            <div class="sets-reps-box">
              <strong>{{ entry.sets }} sets × {{ entry.reps }} reps</strong>
              {% if entry.rest %}
                <div>Rest: {{ entry.rest }}</div>
              {% endif %}
            </div>

            {% if entry.notes %}
              <div>{{ entry.notes }}</div>
            {% endif %}

            {% if exercise.description %}
              <div class="exercise-description">{{ exercise.description }}</div>
            {% endif %}

            {% if exercise.image_url %}
              <img src="{{ exercise.image_url }}" alt="{{ exercise.name }}" class="exercise-image">
            {% endif %}
          </div>
          {% endwith %}
        {% empty %}
          <p>No exercises found for this muscle group.</p>
        {% endfor %}
      {% endfor %}

    {% else %}
      <div class="error-box">
        <h3>No Exercises Generated</h3>
        <p>Try adjusting your filters or selecting more options.</p>
        <a href="{% url 'workout_generator_page' %}" class="btn">Back to Generator</a>
      </div>
    {% endif %}

    {% if category and exercises or workout %}
      <div class="action-buttons">
        <a href="{% url 'workout_generator_page' %}" class="btn">Generate New Workout</a>
        <a href="#" onclick="window.print(); return false;" class="btn">Print Workout</a>
        <a href="#" class="btn" onclick="alert('Save feature coming soon!'); return false;">Save Workout</a>
      </div>
    {% endif %}

  </div>

  <footer>
    <p>MocFit+ © 2025</p>
  </footer>
</body>
</html>